steps:
### [BUILD APP] ###
  - name: golang:1.19
    id: build-app
    entrypoint: /bin/bash
    args:
    - -c
    - |
      BINARY_NAME=helm-wrapper
      GOPATH = $(shell go env GOPATH)
      LDFLAGS="-s -w"
      rm -rf bin/${BINARY_NAME}
	    CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags ${LDFLAGS} -o bin/${BINARY_NAME}

### [BUILD CONTAINER] ###
  - name: 'gcr.io/cloud-builders/docker'
    id: build-container-image
    entrypoint: /bin/bash
    args: ['-c', 'docker build -t gcr.io/${PROJECT_ID}/helm-api:build .']

### [PUBLISH CONTAINER IMAGE] ###
  - name: 'gcr.io/cloud-builders/docker'
    id: publish-container-image
    entrypoint: /bin/bash
    args:
    - -c
    - |
      docker tag gcr.io/${PROJECT_ID}/helm-api:build gcr.io/${PROJECT_ID}/helm-api:0.0.1-dev && \
      docker push gcr.io/${PROJECT_ID}/helm-api:0.0.1-dev
